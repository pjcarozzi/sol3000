{smcl}
{com}{sf}{ul off}{txt}
{com}. 
. /***
> 4.1 - Variables y etiquetas
> ===========================
> 
> Volvamos a revisar las variables presentes en la base de datos.
> 
> ***/
. 
. describe

{txt}Contains data from {res}data_casen_2017_1prc.dta
{txt}  obs:{res}         2,164                          
{txt} vars:{res}            29                          22 Mar 2019 02:16
{txt} size:{res}       502,048                          
{txt}{hline}
              storage   display    value
variable name   type    format     label      variable label
{hline}
{p 0 48}{res}{bind:folio          }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Identificacion hogar (comuna area seg viv hogar){p_end}
{p 0 48}{bind:o              }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Orden{p_end}
{p 0 48}{bind:id_vivienda    }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Identificador de la vivienda (comuna area seg viv){p_end}
{p 0 48}{bind:hogar          }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Identificacion del hogar en la vivienda{p_end}
{p 0 48}{bind:region         }{txt}{bind: double  }{bind:{txt}%49.0g    }{space 1}{bind:region   }{bind:  }{res}{res}Region{p_end}
{p 0 48}{bind:provincia      }{txt}{bind: double  }{bind:{txt}%23.0g    }{space 1}{txt}provincia{p_end}
{p 0 48}{space 44}{bind:  }{res}{res}Provincia{p_end}
{p 0 48}{bind:comuna         }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:comuna   }{bind:  }{res}{res}Comuna{p_end}
{p 0 48}{bind:zona           }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:zona     }{bind:  }{res}{res}Zona{p_end}
{p 0 48}{bind:expr           }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Factor de Expansion Regional{p_end}
{p 0 48}{bind:expc           }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Factor de Expansion Comunal{p_end}
{p 0 48}{bind:expr_div       }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Factor de expansion orientacion sexual (r23) e identidad de genero (r24){p_end}
{p 0 48}{bind:varstrat       }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Estratos de Varianza{p_end}
{p 0 48}{bind:varunit        }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Conglomerados de Varianza{p_end}
{p 0 48}{bind:sexo           }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:sexo     }{bind:  }{res}{res}Sexo{p_end}
{p 0 48}{bind:edad           }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Edad{p_end}
{p 0 48}{bind:ecivil         }{txt}{bind: double  }{bind:{txt}%47.0g    }{space 1}{bind:ecivil   }{bind:  }{res}{res}Estado civil{p_end}
{p 0 48}{bind:o1             }{txt}{bind: double  }{bind:{txt}%19.0g    }{space 1}{bind:DICO     }{bind:  }{res}{res}o1. La semana pasada, trabajo al menos una hora, sin considerar los quehaceres{p_end}
{p 0 48}{bind:o2             }{txt}{bind: double  }{bind:{txt}%19.0g    }{space 1}{bind:DICO     }{bind:  }{res}{res}o2. Aunque no trabajo la semana pasada, realizo alguna actividad por lo menos d{p_end}
{p 0 48}{bind:o3             }{txt}{bind: double  }{bind:{txt}%19.0g    }{space 1}{bind:DICO     }{bind:  }{res}{res}o3. Aunque no trabajo la semana pasada, tenia algun empleo, negocio u otra acti{p_end}
{p 0 48}{bind:o6             }{txt}{bind: double  }{bind:{txt}%19.0g    }{space 1}{bind:DICO     }{bind:  }{res}{res}o6. Busco trabajo remunerado o realizo alguna gestion para iniciar una activida{p_end}
{p 0 48}{bind:oficio1        }{txt}{bind: double  }{bind:{txt}%60.0g    }{space 1}{bind:oficio1  }{bind:  }{res}{res}o9a_cod. Cual es su ocupacion u oficio? (1 digito){p_end}
{p 0 48}{bind:ytotcorh       }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Ingreso total del hogar corregido{p_end}
{p 0 48}{bind:ypc            }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Ingreso total per capita del hogar corregido{p_end}
{p 0 48}{bind:numper         }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Numero de personas en el hogar (excluye sdpa){p_end}
{p 0 48}{bind:asiste         }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:asiste   }{bind:  }{res}{res}Asiste{p_end}
{p 0 48}{bind:esc            }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Escolaridad{p_end}
{p 0 48}{bind:educ           }{txt}{bind: double  }{bind:{txt}%33.0g    }{space 1}{bind:educ     }{bind:  }{res}{res}Nivel Educacional{p_end}
{p 0 48}{bind:depen          }{txt}{bind: double  }{bind:{txt}%48.0g    }{space 1}{bind:depen    }{bind:  }{res}{res}Dependencia Administrativa{p_end}
{p 0 48}{bind:activ          }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:activ    }{bind:  }{res}{res}Condicion de actividad{p_end}
{txt}{hline}
Sorted by: {res}esc
{txt}
{com}. 
. /***
> Stata tiene distintas formas de identificar una variable:
> 
> - _Variable name_. El nombre de la variable, que por conveniencia suele mantenerse
> corto para facilitar su uso mediante comandos.
> 
> - _Variable label_. La etiqueta de la variable, lo que describe a la variable. Si una
> variable tiene etiqueta, este sera el nombre que aparece en las tablas y graficos,
> entre otros.
> 
> - _Value label_. El nombre de la etiqueta de valores que contiene los nombres de
> los atributos de la variable. Las variables continuas no suelen estar asociadas a una
> etiqueta de valores, pero estos son utiles para identificar los atributos de las
> variables categoricas. 
> 
> [codebook](https://www.stata.com/manuals13/dcodebook.pdf#dcodebook) y
> [labelbook](https://www.stata.com/manuals13/dlabelbook.pdf#dlabelbook) nos permiten
> conocer estos identificadores.
> 
> [codebook](https://www.stata.com/manuals13/dcodebook.pdf#dcodebook) examina los 
> nombres y etiquetas de las variables. Si no especificamos ninguna variable junto
> el comando, [codebook](https://www.stata.com/manuals13/dcodebook.pdf#dcodebook) 
> nos muestra informacion para todas las variables en la base de datos. Tambien podemos
> ejecutar el comando seguido de una variable o lista de variables.
> 
> Exploremos la ocupacion u oficio de los casos en la muestra.
> 
> ***/
. 
. codebook oficio1

{txt}{hline}
{res}oficio1{right:o9a_cod. Cual es su ocupacion u oficio? (1 digito)}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})
{ralign 22:label}:  {res:oficio1}

{col 18}range:  [{res}0{txt},{res}999{txt}]{col 55}units:  {res}1
{col 10}{txt}unique values:  {res}11{col 51}{txt}missing .:  {res}1,206{txt}/{res}2,164

{txt}{ralign 23: examples:}{col 26}{res}5{col 32}{txt}Trabajadores de los servicios y vendedores de comerci
{ralign 23: }{col 26}{res}9{col 32}{txt}Trabajadores no calificado
{ralign 23: }{col 26}{res}.{col 32}{txt}
{ralign 23: }{col 26}{res}.{col 32}{txt}

{com}. 
. /***
> 
> Podemos observar que la variable oficio1 es una variable categorica, con un rango 
> de atributos que va del 0 al 999. Cuando las variables poseen muchos atributos 
> (etiquetados), [codebook](https://www.stata.com/manuals13/dcodebook.pdf#dcodebook) 
> no muestra sino parte de ellos, como en este caso.
> 
> Si queremos ver todos los atributos etiquetados asociados a las variable, 
> usamos el comando [labelbook](https://www.stata.com/manuals13/dlabelbook.pdf#dlabelbook).
> 
> [labelbook](https://www.stata.com/manuals13/dlabelbook.pdf#dlabelbook), a diferencia
> de [codebook](https://www.stata.com/manuals13/dcodebook.pdf#dcodebook), no se 
> refiere a las variables en si, sino a las etiquetas de variables, que son 
> registradas en Stata como informacion independiente. Varias variables pueden
> compartir una etiqueta de variables. 
> 
> Debido a esto, necesitamos identificar previamente el nombre de la etiqueta de variables 
> que esta asociada a la variable de interes. El output de 
> [codebook](https://www.stata.com/manuals13/dcodebook.pdf#dcodebook) 
> nos muestra esta informacion. En este caso, la etiqueta de variable de _oficio1_
> tambien se llama _oficio1_.
> 
> Si ejecutamos [labelbook](https://www.stata.com/manuals13/dlabelbook.pdf#dlabelbook)
> sin especificaciones, se desplegara el libro de etiquetas completo. Nuevamente, si ejecutamos 
> [labelbook](https://www.stata.com/manuals13/dlabelbook.pdf#dlabelbook) seguido por
> una etiqueta de variable o una lista de etiquetas de variables, nos mostrara los
> atributos etiquetados solo para estas etiquetas.
> 
> ***/
. 
. labelbook oficio1

{txt}{hline}
value label {res}oficio1 
{txt}{hline}

{col 7}{hi:values}{col 49}{hi:labels}
{col 8}range:  [{res}0{txt},{res}999{txt}]{col 42}string length:  [{res}8{txt},{res}60{txt}]
{col 12}N:  {res}11{col 34}{txt}unique at full length:  {res}yes
{col 9}{txt}gaps:  {res}yes{col 36}{txt}{ralign 20:unique at length 12:}  {res}no
{col 3}{txt}missing .*:  {res}0{col 44}{txt}null string:  {res}no
{col 32}{txt}leading/trailing blanks:  {res}no
{col 37}{txt}numeric -> numeric:  {res}no
  {hi:definition}
{txt}{p 0 15 2}{space 11}0{space 2}
{res}   {ul:Fuerzas Arma}{res}da
{p_end}
{txt}{p 0 15 2}{space 11}1{space 2}
{res}   {ul:Miembros del}{res} poder ejecutivo y de los cuerpos legislativo
{p_end}
{txt}{p 0 15 2}{space 11}2{space 2}
{res}   {ul:Profesionale}{res}s, cientificos e intelectuale
{p_end}
{txt}{p 0 15 2}{space 11}3{space 2}
{res}   {ul:Tecnicos pro}{res}fesionales de nivel medi
{p_end}
{txt}{p 0 15 2}{space 11}4{space 2}
{res}   {ul:Empleados de}{res} oficina
{p_end}
{txt}{p 0 15 2}{space 11}5{space 2}
{res}   {ul:Trabajadores}{res} de los servicios y vendedores de comerci
{p_end}
{txt}{p 0 15 2}{space 11}6{space 2}
{res}   {ul:Agricultores}{res} y trabajadores calificados agropecuarios y pesq
{p_end}
{txt}{p 0 15 2}{space 11}7{space 2}
{res}   {ul:Oficiales, o}{res}perarios y artesanos de artes mecanicas y de otr
{p_end}
{txt}{p 0 15 2}{space 11}8{space 2}
{res}   {ul:Operadores d}{res}e instalaciones y maquinas y montadore
{p_end}
{txt}{p 0 15 2}{space 11}9{space 2}
{res}   {ul:Trabajadores}{res} no calificado
{p_end}
{txt}{p 0 15 2}{space 9}999{space 2}
{res}Sin dato
{p_end}

{txt}{p 3 15}variables:{space 2}{res}oficio1

{txt}
{com}. 
. /***
> Podemos ver que, si bien el rango de valores de _oficio1_ va de 0 a 999, no todos
> los valores estan etiquetados. El valor 999 corresponde a "Sin dato". En este 
> caso, la etiqueta de valores _oficio1_ solo es usada por la variable _oficio1_.
> 
> Revisemos otra etiqueta de valores:
> ***/
. 
. labelbook DICO

{txt}{hline}
value label {res}DICO 
{txt}{hline}

{col 7}{hi:values}{col 49}{hi:labels}
{col 8}range:  [{res}1{txt},{res}9{txt}]{col 42}string length:  [{res}2{txt},{res}19{txt}]
{col 12}N:  {res}3{col 34}{txt}unique at full length:  {res}yes
{col 9}{txt}gaps:  {res}yes{col 36}{txt}{ralign 20:unique at length 12:}  {res}yes
{col 3}{txt}missing .*:  {res}0{col 44}{txt}null string:  {res}no
{col 32}{txt}leading/trailing blanks:  {res}no
{col 37}{txt}numeric -> numeric:  {res}no
  {hi:definition}
{txt}{p 0 15 2}{space 11}1{space 2}
{res}Si
{p_end}
{txt}{p 0 15 2}{space 11}2{space 2}
{res}No
{p_end}
{txt}{p 0 15 2}{space 11}9{space 2}
{res}   {ul:No sabe/no r}{res}esponde
{p_end}

{txt}{p 3 15}variables:{space 2}{res}o1 o2 o3 o6

{txt}
{com}. 
. /***
> La etiqueta de valores _DICO_, definida como 1 "si", 2 "no", 9 "no sabe/no responde", 
> es compartida por las variables _o1_, _o2_, _o3_ y _o6_.
> 
> 4.2 - Recodificaciones
> ======================
> 
> Identificar previamente el nivel de medicion y los atributos de las variables es
> necesario a la hora de recodificar variables, o crear variables a partir de las 
> existentes. 
> 
> Dos comandos basicos que permiten recodificar datos son 
> [generate](https://www.stata.com/manuals13/dgenerate.pdf#dgenerate) y
> [replace](https://www.stata.com/manuals13/dgenerate.pdf#dgenerate).
> 
> [generate](https://www.stata.com/manuals13/dgenerate.pdf#dgenerate), abreviado 
> gen o g, nos permite crear una nueva variable especificando su nombre y una 
> expresion que determinara su contenido.
> 
> Creemos una variable llamada _varnueva_ en la cual todas las observaciones 
> compartan el valor 1.  
> ***/ 
. 
. gen varnueva=1
{txt}
{com}. 
. list varnueva in 1/5
{txt}
     {c TLC}{hline 10}{c TRC}
     {c |} {res}varnueva {txt}{c |}
     {c LT}{hline 10}{c RT}
  1. {c |} {res}       1 {txt}{c |}
  2. {c |} {res}       1 {txt}{c |}
  3. {c |} {res}       1 {txt}{c |}
  4. {c |} {res}       1 {txt}{c |}
  5. {c |} {res}       1 {txt}{c |}
     {c BLC}{hline 10}{c BRC}

{com}. 
. /***
> [replace](https://www.stata.com/manuals13/dgenerate.pdf#dgenerate) cambia el 
> contenido de una variable existente. 
> 
> Reemplacemos el contenido de _varnueva_ indicando que todas las observaciones
> tengan el valor 7
> ***/
. 
. replace varnueva=7
{txt}(2,164 real changes made)

{com}. 
. list varnueva in 1/5
{txt}
     {c TLC}{hline 10}{c TRC}
     {c |} {res}varnueva {txt}{c |}
     {c LT}{hline 10}{c RT}
  1. {c |} {res}       7 {txt}{c |}
  2. {c |} {res}       7 {txt}{c |}
  3. {c |} {res}       7 {txt}{c |}
  4. {c |} {res}       7 {txt}{c |}
  5. {c |} {res}       7 {txt}{c |}
     {c BLC}{hline 10}{c BRC}

{com}. 
. /***
> Eliminemos _varnueva_
> ***/
. 
. drop varnueva
{txt}
{com}. 
. /***
> Los qualifiers y operadores que ya revisamos nos permitiran recodificar variables.
> Usemos operadores aritmeticos para calcular el ingreso total per capita para 
> cada observacion de la muestra, creando una variable que se llamara _ypcapita_.
> 
> Utilizaremos dos variables existentes: _ytotcorh_, el ingreso total del hogar, y
> _numper_, el numero de personas en el hogar.
> ***/
. 
. gen ypcapita=ytotcorh/numper
{txt}(2 missing values generated)

{com}. 
. /***
> Revisemos los estadisticos descriptivos para el ingreso total per capita.
> ***/
. 
. summarize ypcapita

{txt}    Variable {c |}        Obs        Mean    Std. Dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 4}ypcapita {c |}{res}      2,162    357332.5    625617.8          0   2.24e+07
{txt}
{com}. 
. /***
> La media de ingreso per capita es $357333. La variable _ypc_, generada por Casen,
> contiene la misma informacion. 
> ***/
. 
. list ypcapita ypc in f/10
{txt}
     {c TLC}{hline 10}{c -}{hline 8}{c TRC}
     {c |} {res}ypcapita      ypc {txt}{c |}
     {c LT}{hline 10}{c -}{hline 8}{c RT}
  1. {c |} {res}283104.3   283104 {txt}{c |}
  2. {c |} {res} 84599.6    84600 {txt}{c |}
  3. {c |} {res}114894.5   114895 {txt}{c |}
  4. {c |} {res}258045.5   258046 {txt}{c |}
  5. {c |} {res}81912.34    81912 {txt}{c |}
     {c LT}{hline 10}{c -}{hline 8}{c RT}
  6. {c |} {res}208187.9   208188 {txt}{c |}
  7. {c |} {res}188515.7   188516 {txt}{c |}
  8. {c |} {res}  243489   243489 {txt}{c |}
  9. {c |} {res}  234932   234932 {txt}{c |}
 10. {c |} {res}146078.1   146078 {txt}{c |}
     {c BLC}{hline 10}{c -}{hline 8}{c BRC}

{com}. 
. /*** 
> Supongamos que nos encargan calcular el porcentaje de personas en edad de trabajar.
> Sabemos que, por definicion de Casen, son personas en edad de trabajar todos quienes
> tienen 15 años o mas. 
> 
> Construyamos una variable dicotomica que identifique con 1 a quienes tienen 15 
> años o mas, y con 0 a quienes tienen menos de 15 años.
> 
> Primero, verifiquemos si la variable _edad_ tiene valores perdidos o si existe un
> valor que identifique que la edad no ha sido registrada (ej. NS/NR, 999).
> ***/
. 
. *codebook edad
. 
. /***
> La variable no tiene casos perdidos. Tampoco se ha codificado un valor tal que nos 
> sugiera dejar fuera algunos casos para los que no existe el dato.
> 
> Usamos la variable _edad_, tal y como es codificada en Casen, y el qualifier 
> [if](https://www.stata.com/manuals13/u11.pdf#u11.1.3ifexp) para crear una nueva 
> variable llamada _pet_.
> ***/
. 
. gen pet=0
{txt}
{com}. replace pet=1 if edad>=15
{txt}(1,760 real changes made)

{com}. 
. /***
> [recode](https://www.stata.com/manuals13/drecode.pdf) es oro comando que podemos 
> usar para cumplir con esta tarea. [recode](https://www.stata.com/manuals13/drecode.pdf)
> cambia los valores numericos de una variable de acuerdo con reglas especificas.
> 
> Esta vez usaremos rangos de edad:
> ***/
. 
. gen pet2=edad
{txt}
{com}. recode pet2 (0/14=0) (15/95=1)
{txt}(pet2: 2143 changes made)

{com}. 
. /***
> Ambas maneras nos entregan los mismos resultados. Corroboremos si la cantidad de 
> personas en edad de trabajar es igual bajo ambas recodificaciones. Utilizamos el
> comando [tabulate](http://www.stata.com/manuals13/rtabulateoneway.pdf#rtabulateoneway),
> abreviado [tab](http://www.stata.com/manuals13/rtabulateoneway.pdf#rtabulateoneway), 
> para obtener tablas de frecuencias y porcentajes. Podemos escribir, en dos pasos:
> ***/
. 
. tab pet

        {txt}pet {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        404       18.67       18.67
{txt}          1 {c |}{res}      1,760       81.33      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      2,164      100.00
{txt}
{com}. tab pet2

       {txt}pet2 {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        404       18.67       18.67
{txt}          1 {c |}{res}      1,760       81.33      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      2,164      100.00
{txt}
{com}. 
. /***
> O en sólo uno:
> ***/
. 
. tab1 pet pet2

{res}-> tabulation of pet  

        {txt}pet {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        404       18.67       18.67
{txt}          1 {c |}{res}      1,760       81.33      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      2,164      100.00

-> tabulation of pet2  

       {txt}pet2 {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          0 {c |}{res}        404       18.67       18.67
{txt}          1 {c |}{res}      1,760       81.33      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      2,164      100.00
{txt}
{com}. 
. /***
> Ambas tablas muestran que tenemos 1760 personas en edad de trabajar, lo que equivale
> a un 81.33% de nuestra muestra.
> 
> Supongamos ahora que nos encargan identificar la condicion de actividad de los
> encuestados, con el fin de calcular las tasas de ocupacion, desocupacion e inactividad.
> 
> Primero necesitamos identificar las variables que nos sirven para construir la
> variable que identifique en la muestra a quienes estan ocupados, desocupados e 
> inactivos. La siguiente figura muestra un fragmento del Modulo Trabajo del 
> [Cuestionario Casen 2017][source2] y sintetiza la logica que seguiremos en nuestra
> recodificacion.
> 
> ![recod](./img/recod.jpg)
> 
> Generamos tablas de frecuencia para las variables que necesitamos usando 
> [tab1](http://www.stata.com/manuals13/rtabulateoneway.pdf#rtabulateoneway)
> con la opcion missing (abreviada m). La opción missing nos permite tratar 
> los datos perdidos como si fueran una categoría adicional y saber cual 
> es su porcentaje en la muestra
> ***/
. 
. tab1 o1 o2 o3 o6, m

{res}-> tabulation of o1  

      {txt}o1. La semana {c |}
 pasada, trabajo al {c |}
menos una hora, sin {c |}
     considerar los {c |}
         quehaceres {c |}      Freq.     Percent        Cum.
{hline 20}{c +}{hline 35}
                 Si {c |}{res}        920       42.51       42.51
{txt}                 No {c |}{res}        840       38.82       81.33
{txt}                  . {c |}{res}        404       18.67      100.00
{txt}{hline 20}{c +}{hline 35}
              Total {c |}{res}      2,164      100.00

-> tabulation of o2  

      {txt}o2. Aunque no {c |}
  trabajo la semana {c |}
    pasada, realizo {c |}
   alguna actividad {c |}
     por lo menos d {c |}      Freq.     Percent        Cum.
{hline 20}{c +}{hline 35}
                 Si {c |}{res}         13        0.60        0.60
{txt}                 No {c |}{res}        827       38.22       38.82
{txt}                  . {c |}{res}      1,324       61.18      100.00
{txt}{hline 20}{c +}{hline 35}
              Total {c |}{res}      2,164      100.00

-> tabulation of o3  

      {txt}o3. Aunque no {c |}
  trabajo la semana {c |}
pasada, tenia algun {c |}
  empleo, negocio u {c |}
          otra acti {c |}      Freq.     Percent        Cum.
{hline 20}{c +}{hline 35}
                 Si {c |}{res}         25        1.16        1.16
{txt}                 No {c |}{res}        802       37.06       38.22
{txt}                  . {c |}{res}      1,337       61.78      100.00
{txt}{hline 20}{c +}{hline 35}
              Total {c |}{res}      2,164      100.00

-> tabulation of o6  

  {txt}o6. Busco trabajo {c |}
       remunerado o {c |}
     realizo alguna {c |}
       gestion para {c |}
        iniciar una {c |}
           activida {c |}      Freq.     Percent        Cum.
{hline 20}{c +}{hline 35}
                 Si {c |}{res}         89        4.11        4.11
{txt}                 No {c |}{res}        713       32.95       37.06
{txt}                  . {c |}{res}      1,362       62.94      100.00
{txt}{hline 20}{c +}{hline 35}
              Total {c |}{res}      2,164      100.00
{txt}
{com}. 
. /***
> En _o1_ tenemos 404 casos perdidos. Esto se explica porque las preguntas de _o1_
> a _o8_ solo son contestadas por quienes tienen 15 años o mas. Podemos comprobarlo
> al ejecutar:
> ***/
. 
. tab o1 if edad<15, m

      {txt}o1. La semana {c |}
 pasada, trabajo al {c |}
menos una hora, sin {c |}
     considerar los {c |}
         quehaceres {c |}      Freq.     Percent        Cum.
{hline 20}{c +}{hline 35}
                  . {c |}{res}        404      100.00      100.00
{txt}{hline 20}{c +}{hline 35}
              Total {c |}{res}        404      100.00
{txt}
{com}. 
. /***
> A las variables _o2_, _o3_ y _o6_ se le suman como casos perdidos quienes han 
> respondido "si" en las preguntas anteriores. 
> ***/
. 
. dis 404+920
{res}1324
{txt}
{com}. dis 1324+13
{res}1337
{txt}
{com}. dis 1337+25 
{res}1362
{txt}
{com}. 
. /*** 
> Creamos una variable nueva, llamada _act_, que sea condicional a los valores de 
> _o1_, _o2_, _o3_ y _o6_, usando el qualifier 
> [if](https://www.stata.com/manuals13/u11.pdf#u11.1.3ifexp).
> 
> _act_ es igual a 1 si el o la encuestada contesto _o1_ u _o2_ u _o3_ con “si”, 
> por lo tanto, se encuentra ocupado/a.
> ***/ 
. 
. gen act=1 if o1==1 | o2==1 | o3==1
{txt}(1,206 missing values generated)

{com}. 
. /***
> Esto genera 1206 casos pedidos para los que la expresion logica no se cumple. 
> Reemplazamos parte de esos casos perdidos con "2" si el o la encuestada responde
> "si" en la pregunta _o6_, por lo tanto, se encuentra desocupado.
> ***/
. 
. replace act=2 if o6==1
{txt}(89 real changes made)

{com}. 
. /***
> Son reemplazados 82 casos para los cuales si se cumplia _o6==1_. Finalmente, 
> nos queda definir a quienes respondieron "no" en _o6_. Alternativamente, podemos
> usar el operador _!=_ y condicionar el remplazo a quienes no respondieron "si"
> en las preguntas anteriores, dejando como perdidos a quienes no son poblacion
> en edad de trabajar (el resultado es el mismo)
> ***/
. 
. replace act=3 if o1!=1 & o2!=1 & o3!=1 & o6!=1
{txt}(1,117 real changes made)

{com}. replace act=. if pet==0 
{txt}(404 real changes made, 404 to missing)

{com}. 
. /***
> Comparamos la variable recien creada tabulando _act_ y _activ_, variable creada
> por Casen que contiene la misma informacion.
> ***/
. 
. tab1 act activ, m

{res}-> tabulation of act  

        {txt}act {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
          1 {c |}{res}        958       44.27       44.27
{txt}          2 {c |}{res}         89        4.11       48.38
{txt}          3 {c |}{res}        713       32.95       81.33
{txt}          . {c |}{res}        404       18.67      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      2,164      100.00

-> tabulation of activ  

  {txt}Condicion {c |}
         de {c |}
  actividad {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
   Ocupados {c |}{res}        958       44.27       44.27
{txt}Desocupados {c |}{res}         89        4.11       48.38
{txt}  Inactivos {c |}{res}        713       32.95       81.33
{txt}          . {c |}{res}        404       18.67      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      2,164      100.00
{txt}
{com}. 
. /***
> O como tabla cruzada
> ***/
. 
. tab act activ, m

           {txt}{c |}           Condicion de actividad
       act {c |}  Ocupados  Desocupad  Inactivos          . {c |}     Total
{hline 11}{c +}{hline 44}{c +}{hline 10}
         1 {c |}{res}       958          0          0          0 {txt}{c |}{res}       958 
{txt}         2 {c |}{res}         0         89          0          0 {txt}{c |}{res}        89 
{txt}         3 {c |}{res}         0          0        713          0 {txt}{c |}{res}       713 
{txt}         . {c |}{res}         0          0          0        404 {txt}{c |}{res}       404 
{txt}{hline 11}{c +}{hline 44}{c +}{hline 10}
     Total {c |}{res}       958         89        713        404 {txt}{c |}{res}     2,164 

{txt}
{com}. 
. /***
> Nos falta identificar la variable _act_ y sus atributos. Primero creamos una 
> etiqueta de variable que la describa
> ***/
. 
. label variable act "Actividad"
{txt}
{com}. 
. /*** 
> Si queremos usar otra etiqueta, simplemente sobreescribimos.
> ***/
. 
. label variable act "Actividad recodificada"
{txt}
{com}. 
. /***
> Ahora etiquetemos los atributos. Primero debemos definir una etiqueta de valores
> y parear cada valor con el atributo que queremos que muestre.
> ***/
. 
. label define valactividad 1 "Ocupado" 2 "Desempleado" 3 "Inactivo"
{txt}
{com}. 
. /***
> Si queremos cambiar algun valor o etiqueta de valor, usamos la opcion _replace_ 
> ***/
. 
. label define valactividad 1 "Ocupado" 2 "Desocupado" 3 "Inactivo", replace
{txt}
{com}. 
. /***
> Si queremos agregar un valor y su etiqueta, usamos la opcion _add_
> ***/
. 
. label define valactividad 9 "No PET", add
{txt}
{com}. 
. /***
> El segundo paso es enlazar la variable a la etiqueta de valores creada.
> ***/
. 
. label values act valactividad
{txt}
{com}. 
. /***
> Tabulemos la variable _act_
> ***/
. 
. tab act, m

  {txt}Actividad {c |}
recodificad {c |}
          a {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
    Ocupado {c |}{res}        958       44.27       44.27
{txt} Desocupado {c |}{res}         89        4.11       48.38
{txt}   Inactivo {c |}{res}        713       32.95       81.33
{txt}          . {c |}{res}        404       18.67      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      2,164      100.00
{txt}
{com}. 
. /***
> Las etiquetas de valores no modifican los valores de las variables. En este caso,
> definimos una etiqueta para el valor "9" como "No PET", pero este no existe en la 
> variable, por lo que simplemente no los muestra. 
> 
> Recodifiquemos a quienes no son poblacion en edad de trabajar como "9" 
> ***/
. 
. replace act=9 if pet==0
{txt}(404 real changes made)

{com}. 
. /***
> Veamos ahora la tabla de frecuencias de _act_
> ***/
. 
. tab act, m

  {txt}Actividad {c |}
recodificad {c |}
          a {c |}      Freq.     Percent        Cum.
{hline 12}{c +}{hline 35}
    Ocupado {c |}{res}        958       44.27       44.27
{txt} Desocupado {c |}{res}         89        4.11       48.38
{txt}   Inactivo {c |}{res}        713       32.95       81.33
{txt}     No PET {c |}{res}        404       18.67      100.00
{txt}{hline 12}{c +}{hline 35}
      Total {c |}{res}      2,164      100.00
{txt}
{com}. 
. /***
> 4.2 - Cerrar sesion
> ===================
> 
> Finalicemos la sesion de hoy. para guardar la base de datos modificada, usamos:
> ***/
. 
. save data_casen_ayud1, replace
{txt}file data_casen_ayud1.dta saved

{com}. 
. /***
> Si estamos usando un _log file_, lo cerramos usando su nombre:
> ***/
. 
. *log close ayudantia
. 
. 
. /***
> [source2]: http://observatorio.ministeriodesarrollosocial.gob.cl/casen-multidimensional/casen/docs/Cuestionario_Casen2017.pdf  "Cuestionario Casen 2017"
> ***/
. 
. quietly log close A1_4_recod
{smcl}
{com}{sf}{ul off}